<!DOCTYPE html>
<html lang="">
<head>
    <meta charset="UTF-8">
    <script src="plotly-latest.min.js"></script>
</head>
<body>
    <div id="graph3D" style="width:600px;
                             height:500px;
                             border:2px solid gray;
                             display:inline-block;"></div>
    <div id="graph2D" style="width:500px;
                             height:500px;
                             display:inline-block;
                             position:absolute;"></div>
    
    <script>
                
        function range(start, stop, step=1){
          var a=[start], b=start;
          while(b<stop){b+=step;a.push(b)}
          return a;
        }
        
        Math.radians = function(deg){ 
            rad = deg * this.PI/180;
            return rad; 
        };
        Math.degrees = function(rad){ 
            deg = rad * 180/this.PI;
            return deg; 
        };
        
        function isInt(n) {
           return n % 1 === 0;
        }
        
        function copyArray(foo){
          var copyOfTheArray = [...foo]
          copyOfTheArray.shift();
          return copyOfTheArray;
        }
        
        
   /////////// Suspension Calculations /////////////////     
        
        var L_top_arm = 200;
        var L_lower_arm = 300;
        //var A_upper0 = Math.radians(10);//current test
        var A_lower0 = Math.radians(0);
        var kpi = Math.radians(10);
        var scrubR = 50;
        var Zb = 75;
        var knuckle = 250;
        
        
        var testing_array = range(-12,12,.5);
        var y = [];
        var x = [];
        var z = [];
        
        function calculate_result(test){
            
            var A_upper0 = Math.radians(test);
            
            var yBE = Math.tan(kpi) * Zb + scrubR;
            var lower_bj_Y0 = Math.cos(A_lower0) * L_lower_arm;
            var contact_Y0 =  lower_bj_Y0 + yBE;
            var lower_pivot_Z0 = (-1) * Math.sin(A_lower0) * L_lower_arm + Zb;
            var top_bj_Y0 =  lower_bj_Y0 - knuckle * Math.sin(kpi);
            var top_bj_Z0 = Zb + knuckle * Math.cos(kpi);
            var top_pivot_Y0 = top_bj_Y0 - Math.cos(A_upper0) * L_top_arm;
            var top_pivot_Z0 = top_bj_Z0 - Math.sin(A_upper0) * L_top_arm;
            var L_eb = Math.sqrt(yBE * yBE + Zb * Zb);
            var A_eb0 = Math.atan(Zb / yBE);
            var A_bd0 = Math.PI/2 - kpi;
            
            //////////////////////////////////////
            
            for(i=-30; i<=30; i++){
                
                var degrees = i;
                var displacement = Math.radians(degrees);

                var A_lower = A_lower0 + displacement;
                var lower_bj_Y = Math.cos(A_lower) * L_lower_arm;
                var lower_bj_Z = lower_pivot_Z0 + Math.sin(A_lower) * L_lower_arm;
                var h = top_pivot_Z0 - lower_bj_Z;
                var w = lower_bj_Y - top_pivot_Y0;
                var L_bc = Math.sqrt(h * h + w * w);
                var A_bc = Math.atan(h / w);
                
                var foo = ((L_bc * L_bc) + (knuckle * knuckle) - (L_top_arm * L_top_arm)) / (2 * L_bc * knuckle);

                if(foo > 1){ continue; }

                var A_cbd = Math.acos(foo);
                var A_bd = A_bc + A_cbd;


                var cam_radian = A_bd - A_bd0;

                var A_eb = A_eb0 + cam_radian;
                var contact_Y = lower_bj_Y + Math.cos(A_eb) * L_eb;
                var Ez = lower_bj_Z - Math.sin(A_eb) * L_eb;

                var bump = Ez;
                var scrub = contact_Y - contact_Y0;
                var camber = Math.degrees(cam_radian);
                
                x.push(bump);
                z.push(parseFloat(camber.toFixed(5)));
                y.push(test);
            }
        }
        
        testing_array.forEach(calculate_result);
        //forEach() passes the current value as parameter to calculate_result()
        
        
   /////////////// Building 3D Graph ////////////////////
        
        var zmin = Math.min(...z);
        var zmax = Math.max(...z);
        var length = Math.max(y.length);
        
        var half = length/2;
        
        if( !isInt(half)){
            half = half-.5;
        }
        
        var xR = copyArray(x);
        var yR = copyArray(y);
        var zR = copyArray(z);
        
        
        var xL = xR.splice(0,half);
        var yL = yR.splice(0,half);
        var zL = zR.splice(0,half);
        // arr.splice(0,10) returns array arr[0]:arr[10] and removes it from arr
        
        
        var traceL= {
            x:xL, y:yL, z:zL,
            mode: 'markers',
            marker: {
                size: 3
            },
            type: 'scatter3d'
        };
        
        var traceR= {
            x:xR, y:yR, z:zR,
            mode: 'markers',
            marker: {
                size: 3
            },
            type: 'scatter3d'
        };
        
        var data_3d = [traceL,traceR];
        
        var layout_3d = {
            scene:{
                xaxis:{title:"Bump"},
                yaxis:{title:"Top Arm Angle"},
                zaxis:{title:"Camber"},
                camera:{
                    eye:{
                        y: -2.25,
                        z: 0,
                        x: 0
                    }
                }
            },
            margin:{
                l: 0,
                r: 0,
                t: 0,
                b: 0
            },
            showlegend: false
        };
        
        Plotly.plot('graph3D', data_3d, layout_3d);
        
    
    ///////////// Build 2D Graph ///////////////////
        
        // take x,y,z arrays
        // get values for x,z where y === whole number divisible by (#)
        // 
        
        var limiter = 2;
        var line_array_y = [];
        var line_array_x = [];
        var line_array_z = [];
        
        
        for(var i=0; i<y.length; i++){
            
            if(y[i] % limiter === 0){
                // i is the index I need
                
                line_array_y.push(y[i]);
                line_array_x.push(x[i]);
                line_array_z.push(z[i]);
                
            }
        }
        
        var data_2d = [];
        var unique = [... new Set(line_array_y)].length;
        var increment = 255/unique;
        var color1 = 0;
        var color2 = 255;
        
        
        while(line_array_y.length > 0){
            
            var yValue = line_array_y[0];
            var last_yValue = line_array_y.lastIndexOf(yValue);
            
            var x_current = line_array_x.splice(0,last_yValue+1);
            var z_current = line_array_z.splice(0,last_yValue+1);
            var y_tossing = line_array_y.splice(0,last_yValue+1);
            
            
            var trace_current = {x:x_current,
                                 y:z_current,
                                 type:'scatter',
                                 name: yValue + " deg",
                                 line: {
                                     color: "rgb(" + color1 + ",0," + color2 + ")"
                                 }
                                };
            
            data_2d.push(trace_current);
            
            color1 = color1 + increment;
            color2 = color2 - increment;
        }
        
        var layout_2d = {
            title:'Bump vs Camber -For different Top-Arm Angles',
            xaxis:{ title: 'Bump' },
            yaxis:{ title: 'Camber' }
        };
        
        Plotly.plot('graph2D',data_2d,layout_2d);
        
    </script>


</body>
</html>